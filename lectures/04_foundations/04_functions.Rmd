---
title: "Functions"
author: "David Gerard"
date: "`r Sys.Date()`"
output:  
  html_document:
    toc: true
    toc_depth: 4
    toc_float: false
    highlight: pygments
urlcolor: "blue"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo       = TRUE, 
                      fig.align  = "center",
                      fig.height = 3, fig.width = 4)
ggplot2::theme_set(ggplot2::theme_bw() + ggplot2::theme(strip.background = ggplot2::element_rect(fill = "white")))
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy()
```

# Learning Objectives

- Formal characterization of functions.
- Chapter 6 from [Advanced R](https://adv-r.hadley.nz/)
    - These lecture notes are mostly taken straight out of Hadley's book. Many thanks for making my life easier.
    - His images, which I use here, are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" height="15" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a>

# Components

A function has three parts:

1. The `formals()`, the list of arguments that control how you call the function.
2. The `body()`, the code inside the function.
3. The `environment()`, the data structure that determines how the function finds the values associated with the names.

```{r}
square <- function(x) {
  x^2
}
formals(square)
body(square)
environment(square)
```

- Below: Black dot is environment, squares are arguments. Body is not graphed.

    <img src="./04_figs_fun/components.png" alt="some S3 objects" width="25%"/>

- **Exception**: Many base functions are written directly in C and don't have these three components.

    ```{r}
    typeof(square)
    typeof(sum)
    typeof(`[[`)
    
    body(sum)
    formals(sum)
    ```

# First class functions

- Functions are objects, just like any other variable.

- Sometimes, functions are called **closures** because they "enclose" their environments. That's why you sometimes see the error
    ```{r, error = TRUE}
    lm[1]
    ```

- So you can pass functions as arguments in a function (like in `optim()`).

```{r}
f <- function(par, dat) {
  sum((par - dat)^2)
}
dat <- rnorm(100)
oout <- optim(par = 0, fn = f, dat = dat, method = "L-BFGS-B")
oout$par
mean(dat)
```


- Functions can return other functions (like in `ecdf()`).

- So, functions can also have attributes.





