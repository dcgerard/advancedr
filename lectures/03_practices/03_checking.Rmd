---
title: "Automatic Checks"
author: "David Gerard"
date: "`r Sys.Date()`"
output:  
  html_document:
    toc: true
    toc_depth: 4
    toc_float: false
    highlight: pygments
urlcolor: "blue"
---

```{r setup, include=FALSE}
set.seed(1)
knitr::opts_chunk$set(echo       = TRUE, 
                      fig.align  = "center",
                      fig.height = 3, 
                      fig.width  = 4)
knitr::opts_knit$set(global.par = TRUE)
ggplot2::theme_set(ggplot2::theme_bw() + ggplot2::theme(strip.background = ggplot2::element_rect(fill = "white")))
```

```{r klippy, echo=FALSE, include=TRUE}
klippy::klippy()
par(mar = c(3, 3, 2, 1),
mgp = c(1.8, 0.4, 0), 
las = 1,
tcl = -.25)
```

# Learning Objectives

- Package Checking
- Continuous Integration
- Chapter 19 from [R Packages](https://r-pkgs.org/index.html)

# Package Checking

- `R CMD check` is a command-line tool for automatic package checking that can automatically detect common problems that are hard to check.

- When you run `R CMD check` can be run from R via
    ```{r, eval = FALSE}
    devtools::check()
    ```

- The check will return errors, warnings, and notes.

- **Errors**: Serious problems you should fix right away.

- **Warnings**: Likely problems that you should fix eventually.

- **Notes**: Minor problems that may or may not be real problems. I would fix them anyway.

- Workflow for package checking:
    1. Run `devtools::check()`
    2. Fix problem.
    3. Repeat until no more problems.
    
# Common issues

- If you run into an error/warning/note that you do not understand, go to the R packages page to understand it: <https://r-pkgs.org/r-cmd-check.html>

- I won't cover all of the checks, but I'll list the ones that I most often need to fix.

- In the "DESCRIPTION" file, your title should be in title case ("This is a Title", not "This is a title"), and not end in a period. 

- Every argument of a documented function needs to be documented, and there cannot be excess documentation.
    - If you have a typo in your `{roxygen2}` documentation, you will get this warning:
    
        ```
        > checking Rd \usage sections ... WARNING
          Undocumented arguments in documentation object 'pkg'
            ‘arg’
          Documented arguments not in \usage in documentation object 'pkg':
            ‘agr’
        ```
        
    - An undocumented function (where you don't have `{roxygen2}` comments or where you added the `@noRd` tag) does not throw such a warning.
    
- Your package should not be too large.
    - R will tell you which folders have large files. 
    - If you are including too much data, that will be an issue.
    - If R tells you that only `libs` is too large then this is usually OK:
    
        ```
        > checking installed package size ... NOTE
            installed size is 5.2Mb
            sub-directories of 1Mb or more:
              libs 4.4Mb
        ```
    
    - The above often occurs when you are using Rcpp.
    
- Failure to specify a package:
    - R will tell you if you have not imported a function, but try to use it. 
    - The error will look like this:
    
        ```
        > checking R code for possible problems ... NOTE
          simreg: no visible global function definition for ‘rnorm’
          Undefined global functions or variables:
            rnorm
          Consider adding
            importFrom("stats", "rnorm")
          to your NAMESPACE file.
        ``` 
        
    - Note that R comes with 
    
## Continuous Integration

