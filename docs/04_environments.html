<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="David Gerard" />

<meta name="date" content="2022-01-18" />

<title>Environments</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="https://dcgerard.github.io/advancedr/au_logo_small.png" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Teaching Website for Advanced R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dcgerard/advancedr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Environments</h1>
<h4 class="author">David Gerard</h4>
<h4 class="date">2022-01-18</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#environment-basics">Environment Basics</a></li>
<li><a href="#parents">Parents</a></li>
<li><a href="#super-assignmennt--">Super Assignmennt <code>&lt;&lt;-</code></a></li>
<li><a href="#hadleys-advanced-r-exercises">Hadley’s Advanced R Exercises</a></li>
<li><a href="#loop-through-environments">Loop through environments</a></li>
<li><a href="#special-environments">Special Environments</a>
<ul>
<li><a href="#package-environments.">Package environments.</a></li>
<li><a href="#function-environment">Function Environment</a></li>
</ul></li>
<li><a href="#applications">Applications</a>
<ul>
<li><a href="#numeric-derivatives">Numeric Derivatives</a></li>
<li><a href="#managing-state">Managing State</a></li>
</ul></li>
<li><a href="#new-functions">New Functions</a></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="learning-objectives" class="section level1">
<h1>Learning Objectives</h1>
<ul>
<li>R Environments</li>
<li>Chapter 7 from <a href="https://adv-r.hadley.nz/">Advanced R</a>
<ul>
<li>These lecture notes are mostly taken straight out of Hadley’s book. Many thanks for making my life easier.</li>
<li>His images, which I use here, are licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" height="15" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"/></a></li>
</ul></li>
</ul>
</div>
<div id="environment-basics" class="section level1">
<h1>Environment Basics</h1>
<ul>
<li><p>Hadley and colleagues made a really great package that, among other things, allows for handling environments: <code>{rlang}</code>. It’s way better than the base R functionality.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span></code></pre></div></li>
<li><p>An <strong>environment</strong> is a fundamental data object in R that determines lexical scoping — i.e. they determine when a name is bound to an object.</p></li>
<li><p>Motivations:</p>
<ul>
<li>Environments are used to make functions self-contained.</li>
<li>Environments are used to separate functions of the same name in different packages.</li>
<li>Environments are used in some object oriented programming aspects of R.</li>
</ul></li>
<li><p>An environment is like a list, except:</p>
<ul>
<li>Everyname must be unique (lists can have multiple elements of the same name).</li>
<li>Names are not ordered (lists are ordered)</li>
<li>All environments (except the empty environment) have “parent” environments that they live in, and</li>
<li>Environments use modify-in-place semantics (not copy-on-modify).</li>
</ul></li>
<li><p>Create a new environment with <code>rlang::env()</code>, which behaves a lot list <code>list()</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">a =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">b =</span> <span class="st">&quot;a&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">c =</span> <span class="fl">2.3</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">d =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div></li>
<li><p>Environments associate names to values without any particular order. Hadley draws them like this:</p>
<p><img src="04_figs_env/bindings.png" alt="Environment Bindings" width="40%"/></p></li>
<li><p>Environments have “reference semantics”, which means that they modify-in-place.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>e2 <span class="ot">&lt;-</span> e1</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>e2<span class="sc">$</span>d <span class="ot">&lt;-</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>e1<span class="sc">$</span>d</span></code></pre></div>
<pre><code>## [1] 4 5 6</code></pre></li>
<li><p>One by-product is that an environemnt can contain itself.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>e1<span class="sc">$</span>d <span class="ot">&lt;-</span> e1</span></code></pre></div>
<p><img src="04_figs_env/loop.png" alt="Environment containing itself" width="40%"/></p></li>
<li><p>Printing an environment just shows its address</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>e1</span></code></pre></div>
<pre><code>## &lt;environment: 0x55ee0fb0cdd0&gt;</code></pre></li>
<li><p>To print the objects of an environment, use <code>rlang::env_print()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_print</span>(e1)</span></code></pre></div>
<pre><code>## &lt;environment: 0x55ee0fb0cdd0&gt;
## parent: &lt;environment: global&gt;
## bindings:
##  * a: &lt;lgl&gt;
##  * b: &lt;chr&gt;
##  * c: &lt;dbl&gt;
##  * d: &lt;env&gt;</code></pre></li>
<li><p>Use <code>rlang::env_names()</code> to get a character vector with names.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_names</span>(e1)</span></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre></li>
<li><p>The current environment is the environment in which the code is currently being executed (where R looks for names). Use <code>rlang::current_env()</code> to get the current environment.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ce <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">current_env</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(ce)</span></code></pre></div>
<pre><code>## [1] &quot;environment&quot;</code></pre></li>
<li><p>The global environment is the environment where you interactively use R. You can access it with <code>rlang::global_env()</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>gl <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">global_env</span>()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(gl)</span></code></pre></div>
<pre><code>## [1] &quot;environment&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env_print</span>(gl)</span></code></pre></div>
<pre><code>## &lt;environment: global&gt;
## parent: &lt;environment: package:rlang&gt;
## bindings:
##  * ce: &lt;env&gt;
##  * e1: &lt;env&gt;
##  * e2: &lt;env&gt;
##  * gl: &lt;env&gt;
##  * q: &lt;fn&gt;</code></pre></li>
<li><p>We can see that the current environment is the global environment with <code>identical()</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(gl, ce)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre></li>
<li><p>You should not use <code>==</code>. This is since <code>==</code> is expecting to be used on a vector, and an environment is not a vector.</p></li>
</ul>
</div>
<div id="parents" class="section level1">
<h1>Parents</h1>
<ul>
<li><p>Every environment has a <strong>parent</strong>. If a name is not found in the current environment then it is searched for in the parent. This is how lexical scoping operates in R.</p></li>
<li><p><code>rlang::env()</code> actually creates a <strong>child</strong> environment. You can either supply the parent or it assumes the parent is the current environment.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>e2a <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="at">d =</span> <span class="dv">4</span>, <span class="at">e =</span> <span class="dv">5</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>e2b <span class="ot">&lt;-</span> <span class="fu">env</span>(e2a, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="04_figs_env/parents.png" alt="parent environments" width="40%"/></p></li>
<li><p>In the above diagram, the pale blue dot represents a pointer to the parent. The left box is the child and the right box is the parent.</p></li>
<li><p><code>rlang::env_parent()</code> gives you the parent.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env_parent</span>(e2b)</span></code></pre></div>
<pre><code>## &lt;environment: 0x55ee12060b08&gt;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>e2a</span></code></pre></div>
<pre><code>## &lt;environment: 0x55ee12060b08&gt;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env_parent</span>(e2a)</span></code></pre></div>
<pre><code>## &lt;environment: R_GlobalEnv&gt;</code></pre></li>
<li><p>Every environment has as an ancestor the empty environment, which has no parent. You can access it with <code>rlang::empty_env()</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>em <span class="ot">&lt;-</span> <span class="fu">empty_env</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_print</span>(em)</span></code></pre></div>
<pre><code>## &lt;environment: empty&gt;
## parent: NULL</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_parents</span>(em)</span></code></pre></div>
<pre><code>## list()</code></pre></li>
<li><p>We can make children of the empty environment with</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>e2c <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="fu">empty_env</span>(), <span class="at">d =</span> <span class="dv">4</span>, <span class="at">e =</span> <span class="dv">5</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>e2d <span class="ot">&lt;-</span> <span class="fu">env</span>(e2c, <span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="04_figs_env/parents-empty.png" alt="parent environment is now empty" width="40%"/></p></li>
<li><p>Your global environment has the empty environment as the progentor.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_parents</span>(rlang<span class="sc">::</span><span class="fu">global_env</span>())</span></code></pre></div>
<pre><code>##  [[1]] $ &lt;env: package:rlang&gt;
##  [[2]] $ &lt;env: package:stats&gt;
##  [[3]] $ &lt;env: package:graphics&gt;
##  [[4]] $ &lt;env: package:grDevices&gt;
##  [[5]] $ &lt;env: package:utils&gt;
##  [[6]] $ &lt;env: package:datasets&gt;
##  [[7]] $ &lt;env: package:methods&gt;
##  [[8]] $ &lt;env: Autoloads&gt;
##  [[9]] $ &lt;env: package:base&gt;
## [[10]] $ &lt;env: empty&gt;</code></pre></li>
<li><p>The ancestors of the global environment are all of the attached packages that ultimately terminate in the empty environment. So <code>env_parents()</code> will stop at the global environment by default.</p></li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>et <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_parents</span>(et)</span></code></pre></div>
<pre><code>## [[1]] $ &lt;env: global&gt;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_parents</span>(et, <span class="at">last =</span> rlang<span class="sc">::</span><span class="fu">empty_env</span>())</span></code></pre></div>
<pre><code>##  [[1]] $ &lt;env: global&gt;
##  [[2]] $ &lt;env: package:rlang&gt;
##  [[3]] $ &lt;env: package:stats&gt;
##  [[4]] $ &lt;env: package:graphics&gt;
##  [[5]] $ &lt;env: package:grDevices&gt;
##  [[6]] $ &lt;env: package:utils&gt;
##  [[7]] $ &lt;env: package:datasets&gt;
##  [[8]] $ &lt;env: package:methods&gt;
##  [[9]] $ &lt;env: Autoloads&gt;
## [[10]] $ &lt;env: package:base&gt;
## [[11]] $ &lt;env: empty&gt;</code></pre>
</div>
<div id="super-assignmennt--" class="section level1">
<h1>Super Assignmennt <code>&lt;&lt;-</code></h1>
<ul>
<li><p>Regular assignment <code>&lt;-</code> creates a variable in the current environment.</p></li>
<li><p>Super assignment <code>&lt;&lt;-</code> modifies an existing variable found in the parent environment. If no such variable exists, it creates one in the global environment.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>()</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 1</code></pre></li>
<li><p>Most of the time, it is not a good idea to use super assignment. Global variables are vary dangerous. We’ll talk about one good application of them in Chapter 10.</p></li>
<li><p>Get and set values from an environment the same way as from a list.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>e3 <span class="ot">&lt;-</span> <span class="fu">env</span>(<span class="at">x =</span> <span class="dv">1</span>, <span class="at">y =</span> <span class="dv">2</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>x</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>e3[[<span class="st">&quot;x&quot;</span>]]</span></code></pre></div>
<pre><code>## [1] 1</code></pre></li>
<li><p>Because environments are unordered, integer subsetting does not work</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>e3[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## Error in e3[[1]]: wrong arguments for subsetting an environment</code></pre></li>
<li><p>Because environments are not vectors, you cannot use sing brackets <code>[]</code>, so you cannot get more than one element.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>e3[<span class="st">&quot;x&quot;</span>]</span></code></pre></div>
<pre><code>## Error in e3[&quot;x&quot;]: object of type &#39;environment&#39; is not subsettable</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>e3[<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)]</span></code></pre></div>
<pre><code>## Error in e3[c(&quot;x&quot;, &quot;y&quot;)]: object of type &#39;environment&#39; is not subsettable</code></pre></li>
<li><p>You get <code>NULL</code> if a variable is not in an environment, just like a list:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>z</span></code></pre></div>
<pre><code>## NULL</code></pre></li>
<li><p>Test if an environment has a binding with <code>rlang::env_has()</code></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_has</span>(e3, <span class="st">&quot;x&quot;</span>)</span></code></pre></div>
<pre><code>##    x 
## TRUE</code></pre>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_has</span>(e3, <span class="st">&quot;z&quot;</span>)</span></code></pre></div>
<pre><code>##     z 
## FALSE</code></pre></li>
<li><p>Unlike a list, you do not remove elements by assigning them to <code>NULL</code>, because the name refers to <code>NULL</code>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>a <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>e3<span class="sc">$</span>a</span></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_has</span>(e3, <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>##    a 
## TRUE</code></pre></li>
<li><p>Use <code>rlang::env_unbind()</code> to remove an object.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_unbind</span>(e3, <span class="st">&quot;a&quot;</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">env_has</span>(e3, <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<pre><code>##     a 
## FALSE</code></pre></li>
</ul>
</div>
<div id="hadleys-advanced-r-exercises" class="section level1">
<h1>Hadley’s Advanced R Exercises</h1>
<ol style="list-style-type: decimal">
<li><p>Create an environment as illustrated by this picture.</p>
<p><img src="04_figs_env/recursive-1.png" alt="recursive" width="40%"/></p></li>
<li><p>Create a pair of environments as illustrated by this picture.</p>
<p><img src="04_figs_env/recursive-2.png" alt="recursive" width="40%"/></p></li>
</ol>
</div>
<div id="loop-through-environments" class="section level1">
<h1>Loop through environments</h1>
<ul>
<li><p>Sometimes, you want to look through all of the ancestor environments to find an object, or for exploration. Here is an example where we count how many objects are in each ancestral environment.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>count_env <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">base_env =</span> rlang<span class="sc">::</span><span class="fu">caller_env</span>(), </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">end_env =</span> rlang<span class="sc">::</span><span class="fu">empty_env</span>()) {</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  nenv <span class="ot">&lt;-</span> <span class="fu">length</span>(rlang<span class="sc">::</span><span class="fu">env_parents</span>(<span class="at">env =</span> base_env, <span class="at">last =</span> end_env))</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  obj_num <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA_real_</span>, <span class="at">length.out =</span> nenv)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  env <span class="ot">&lt;-</span> base_env</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_len</span>(nenv)) {</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    obj_num[[i]] <span class="ot">&lt;-</span> <span class="fu">length</span>(env)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(obj_num)[[i]] <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env_name</span>(env)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    env <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env_parent</span>(env)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(obj_num)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="fu">count_env</span>()</span></code></pre></div>
<pre><code>##            global     package:rlang     package:stats  package:graphics 
##                15               478               456                88 
## package:grDevices     package:utils  package:datasets   package:methods 
##               119               221               104               371 
##         Autoloads      package:base 
##                 1              1370</code></pre></li>
<li><p>The caller environment is the environment of the function that called the current function. See below.</p></li>
</ul>
</div>
<div id="special-environments" class="section level1">
<h1>Special Environments</h1>
<ul>
<li>Most environments are created by R, not by you. Let’s talk about these.</li>
</ul>
<div id="package-environments." class="section level2">
<h2>Package environments.</h2>
<ul>
<li><p>Each package attached by <code>library()</code> creates an package environment that becomes an ancestor of the global environment. They are parents in the order that you attached them.</p>
<p><img src="04_figs_env/search-path.png" alt="recursive" width="70%"/></p></li>
<li><p>This order is called the <strong>search path</strong> because variable names are searched in that order. You can see the search path with <code>rlang::search_envs()</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">search_envs</span>()</span></code></pre></div>
<pre><code>##  [[1]] $ &lt;env: global&gt;
##  [[2]] $ &lt;env: package:rlang&gt;
##  [[3]] $ &lt;env: package:stats&gt;
##  [[4]] $ &lt;env: package:graphics&gt;
##  [[5]] $ &lt;env: package:grDevices&gt;
##  [[6]] $ &lt;env: package:utils&gt;
##  [[7]] $ &lt;env: package:datasets&gt;
##  [[8]] $ &lt;env: package:methods&gt;
##  [[9]] $ &lt;env: Autoloads&gt;
## [[10]] $ &lt;env: package:base&gt;</code></pre></li>
<li><p>So if I try to evaluate a variable/function name, then it will first search for it in the global environment, then in the <code>{rlang}</code> package environment, then in the <code>{stats}</code> package environment, etc…</p></li>
<li><p>Attaching a new package with <code>library()</code> makes that package the immediate parent of the global environment.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(d)</span></code></pre></div>
<p><img src="04_figs_env/search-path-2.png" alt="recursive" width="70%"/></p></li>
</ul>
</div>
<div id="function-environment" class="section level2">
<h2>Function Environment</h2>
<ul>
<li><p>The <strong>function environment</strong> is the environment where the function finds its variables. This is the current environment when the function is created.</p></li>
<li><p>You can see the function environment via <code>rlang::fn_env()</code></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">fn_env</span>(base<span class="sc">::</span>sum)</span></code></pre></div>
<pre><code>## &lt;environment: namespace:base&gt;</code></pre></li>
<li><p>This may or may not be different from the environment where the name is bound to the function. This is called the <strong>binding environment</strong> of the function.</p></li>
<li><p>In many cases, the function environment is the same as the binding environment. Below, the name <code>f</code> in the global environment is bound to the function (binding environment), and the function is bound to the global environment (function environment):</p>
<p><img src="04_figs_env/binding.png" alt="recursive" width="40%"/></p></li>
<li><p>Below, the name <code>g</code> in the <code>e</code> environment was created in the global environment. So the function envrionment is the global environment, but the name <code>g</code> is in the <code>e</code> environment.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>()</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>e<span class="sc">$</span>g <span class="ot">&lt;-</span> <span class="cf">function</span>() <span class="dv">1</span></span></code></pre></div>
<p><img src="04_figs_env/binding-2.png" alt="recursive" width="40%"/></p></li>
</ul>
</div>
</div>
<div id="applications" class="section level1">
<h1>Applications</h1>
<div id="numeric-derivatives" class="section level2">
<h2>Numeric Derivatives</h2>
<ul>
<li><p><code>stats::numericDeriv()</code> numerically evaluates the gradient of an expression at some value. It assumes that the evaluation occurs within some environment you provide.</p></li>
<li><p>Let’s calculate the gradient of <span class="math inline">\(x^y\)</span> evaluated at <span class="math inline">\(x = 3\)</span>.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>myenv <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">x =</span> <span class="dv">3</span>, <span class="at">y =</span> <span class="dv">2</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">numericDeriv</span>(<span class="at">expr =</span> rlang<span class="sc">::</span><span class="fu">expr</span>(x <span class="sc">^</span> y), <span class="at">theta =</span> <span class="st">&quot;x&quot;</span>, <span class="at">rho =</span> myenv)</span></code></pre></div>
<pre><code>## [1] 9
## attr(,&quot;gradient&quot;)
##      [,1]
## [1,]    6</code></pre></li>
<li><p>From calculus, we know that the derivative of <span class="math inline">\(x^2\)</span> is <span class="math inline">\(2x\)</span>, and so the gradient evaluated at <span class="math inline">\(x = 3\)</span> should be <span class="math inline">\(2\times 3 = 6\)</span>.</p></li>
<li><p><code>rlang::expr()</code> is discussed in Chapter 19. Basically, it captures an expression without evaluating it. This is called “quoting”. We can then evaluate that expression with <code>eval()</code>.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">expr</span>(x<span class="sc">^</span><span class="dv">2</span>) </span></code></pre></div>
<pre><code>## x^2</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">expr</span>(x<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">eval</span>(<span class="at">envir =</span> myenv)</span></code></pre></div>
<pre><code>## [1] 9</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">expr</span>(<span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)))</span></code></pre></div>
<pre><code>## sum(c(1, 2, 3))</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>rlang<span class="sc">::</span><span class="fu">expr</span>(<span class="fu">sum</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))) <span class="sc">|&gt;</span> <span class="fu">eval</span>(<span class="at">envir =</span> rlang<span class="sc">::</span><span class="fu">global_env</span>())</span></code></pre></div>
<pre><code>## [1] 6</code></pre></li>
</ul>
</div>
<div id="managing-state" class="section level2">
<h2>Managing State</h2>
<ul>
<li><p>An R package cannot alter the global environment.</p></li>
<li><p>Objects in packages are locked, so cannot be changed.</p></li>
<li><p>Say you want to keep track of whether or not a function was run (e.g. to write a message on first use). I have done this to (i) say that a function is defunct or (ii) list out special licenses that cover a method.</p></li>
<li><p>One way you could keep track of this is to use superassign in a function that will change the value of a logical in the package environment.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>ran_fun <span class="ot">&lt;-</span> <span class="cn">FALSE</span> <span class="do">## Global variable</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>ran_fun) {</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Here is a message&quot;</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>    ran_fun <span class="ot">&lt;&lt;-</span> <span class="cn">FALSE</span> <span class="do">## this alters package environment</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div>
<pre><code>## Here is a message</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div>
<pre><code>## Here is a message</code></pre></li>
<li><p>What I think is better is having an environment specific to messages, that way you have to worry less about global variables.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>menv <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">env</span>(<span class="at">ran_fun =</span> <span class="cn">FALSE</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>menv<span class="sc">$</span>ran_fun) {</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Here is a message&quot;</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>    menv<span class="sc">$</span>ran_fun <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div>
<pre><code>## Here is a message</code></pre>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div></li>
<li><p>This functionality is very popular, so <code>{rlang}</code> has a function dedicated to it.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fun <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  rlang<span class="sc">::</span><span class="fu">warn</span>(<span class="st">&quot;Here is a message&quot;</span>, <span class="at">.frequency =</span> <span class="st">&quot;once&quot;</span>, <span class="at">.frequency_id =</span> <span class="st">&quot;ran_fun&quot;</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div>
<pre><code>## Warning: Here is a message
## This warning is displayed once per session.</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fun</span>()</span></code></pre></div></li>
</ul>
</div>
</div>
<div id="new-functions" class="section level1">
<h1>New Functions</h1>
<ul>
<li><code>rlang::env()</code>: Create a new child environment.</li>
<li><code>rlang::env_print()</code>: Print an environment’s bindings.</li>
<li><code>rlang::env_names()</code>: Print names in an environment.</li>
<li><code>rlang::env_parent()</code>: Print the parent of an environment.</li>
<li><code>rlang::env_has()</code>: Test if an environment has a binding.</li>
<li><code>rlang::current_env()</code>: Access current environment.</li>
<li><code>rlang::env_bind()</code>: Add objects to an environment.</li>
<li><code>rlang::env_unbind()</code>: Remove objects from an environment.</li>
<li><code>rlang::global_env()</code>: Access global environment.</li>
<li><code>rlang::empty_env()</code>: Access the empty environment.</li>
<li><code>rlang::search_envs()</code>: Show the search path.</li>
<li><code>identical()</code>: Check if two objects are exactly equal.</li>
</ul>
</div>

<!DOCTYPE html>
<hr>
<a href="https://nsf.gov/awardsearch/showAward?AWD_ID=2132247"><img src="https://dcgerard.github.io/advancedr/nsf_logo.png" alt="National Science Foundation Logo" height="48px"/></a>
<a href="https://www.american.edu/cas/mathstat/"><img src="https://dcgerard.github.io/advancedr/au_logo.png" alt="American University Logo" height="48px"/></a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
