<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="David Gerard" />

<meta name="date" content="2022-01-17" />

<title>R Packages</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="https://dcgerard.github.io/advancedr/au_logo_small.png" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Teaching Website for Advanced R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dcgerard/advancedr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">R Packages</h1>
<h4 class="author">David Gerard</h4>
<h4 class="date">2022-01-17</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#prereqs">Prereqs</a></li>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#package-states">Package States</a></li>
<li><a href="#package-structure">Package Structure</a>
<ul>
<li><a href="#create-a-package-skeleton">Create a package skeleton</a></li>
</ul></li>
<li><a href="#the-r-folder">The R folder</a></li>
<li><a href="#documentation">Documentation</a>
<ul>
<li><a href="#formatting">Formatting</a></li>
</ul></li>
<li><a href="#namespace">Namespace</a>
<ul>
<li><a href="#exporting">Exporting</a></li>
<li><a href="#importing">Importing</a></li>
<li><a href="#technical-notes-on-importing">Technical notes on importing</a></li>
<li><a href="#practical-suggestions">Practical suggestions</a></li>
</ul></li>
<li><a href="#description-file">DESCRIPTION file</a></li>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#including-datasets">Including Datasets</a>
<ul>
<li><a href="#external-data">External data</a></li>
<li><a href="#internal-data">Internal Data</a></li>
</ul></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="learning-objectives" class="section level1">
<h1>Learning Objectives</h1>
<ul>
<li>Structure of an R package.</li>
<li>Documenting R packages.</li>
<li>Workflow for building R packages.</li>
<li>Required: Chapters 1–10 and 13–14 from <a href="https://r-pkgs.org/index.html">R Packages</a>.</li>
<li>Resource: <a href="https://cran.r-project.org/doc/manuals/R-exts.html">Writing R Extensions</a></li>
</ul>
</div>
<div id="prereqs" class="section level1">
<h1>Prereqs</h1>
<ul>
<li><p>Make sure you have the following packages installed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pkgvec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;usethis&quot;</span>, <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;roxygen2&quot;</span>, <span class="st">&quot;testthat&quot;</span>, <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;covr&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pkg <span class="cf">in</span> pkgvec) {</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(pkg, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(pkg)  </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>The <code>{usethis}</code> and <code>{devtools}</code> packages automate many of the tedious tasks of package development, allowing you to focus on writing R code. These are the packages we will mostly use.</p></li>
</ul>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<ul>
<li>Why build an R package?</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Share your code/methods with others.</p></li>
<li><p>Re-use functions for yourself.</p></li>
</ol>
</div>
<div id="package-states" class="section level1">
<h1>Package States</h1>
<ul>
<li><p>The same R package is in a different format/state at different points of development.</p>
<ul>
<li>Source -&gt; bundled -&gt; binary -&gt; installed -&gt; in-memory.</li>
</ul></li>
<li><p><strong>Source package</strong>: A directory of files (R scripts, documentation files, test scripts, etc) with a specific structure. This lecture is about developing source packages.</p></li>
<li><p><strong>Bundled package</strong>: A source package that has been compressed into a single file (along with a few other operations). These usually end in “.tar.gz”. We use the following to create a bundled package from a source package:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">build</span>()</span></code></pre></div>
<p>You typically only do this when you are about to submit to CRAN.</p></li>
<li><p><strong>Binary package</strong>: A ready-to-install version for folks who do not have R development tools. You typically don’t need to worry about this. If you submit to CRAN, then they will create binaries for you.</p></li>
<li><p><strong>Installed package</strong>: Installing a package decompresses/places your package in the library directory. This makes it so that you can use <code>library()</code> to load a package.</p>
<ul>
<li><p>Terminology: A <strong>package</strong> is a collection of functions, along with documentation, in a specific format. A <strong>library</strong> is a directory (folder) on your computer that contains installed packages.</p></li>
<li><p>Confusingly, you use the <code>library()</code> function to load a package.</p></li>
<li><p>You can see/control your active libraries with</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/home/dgerard/R/x86_64-pc-linux-gnu-library/4.1&quot;
## [2] &quot;/usr/local/lib/R/site-library&quot;                  
## [3] &quot;/usr/lib/R/site-library&quot;                        
## [4] &quot;/usr/lib/R/library&quot;</code></pre></li>
<li><p>For example, these are some of the packages in /home/dgerard/R/x86_64-pc-linux-gnu-library/4.1</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">list.files</span>(<span class="at">path =</span> <span class="fu">.libPaths</span>()[[<span class="dv">1</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;abind&quot;         &quot;amen&quot;          &quot;animation&quot;     &quot;annotate&quot;     
## [5] &quot;AnnotationDbi&quot; &quot;ape&quot;</code></pre></li>
</ul></li>
<li><p>Ways to install a package:</p>
<ul>
<li>From CRAN: <code>install.packages()</code>.</li>
<li>From Bioconductor: <code>BiocManager::install()</code>.</li>
<li>From source package: <code>devtools::install()</code>.</li>
<li>From GitHub <code>devtools::install_github()</code>.</li>
</ul></li>
<li><p><strong>In-memory package</strong>: makes functions in a package available for use.</p>
<ul>
<li>Use <code>library()</code> to place an installed package in memory.</li>
<li>Use <code>devtools::load_all()</code> to place a source package in memory. You typically do this during your workflow when you are building your package.</li>
</ul></li>
</ul>
</div>
<div id="package-structure" class="section level1">
<h1>Package Structure</h1>
<ul>
<li><p>A typical package will have this directory/file structure</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> DESCRIPTION</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .git</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .gitignore</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> LICENSE.md</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> man</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   ├── f1.Rd</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── f2.Rd</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> NAMESPACE</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> R</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── rcode.R</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> .Rbuildignore</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.md</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> README.Rmd</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> src</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── cppcode.cpp</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> tests</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="ex">├──</span> testthat</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="ex">│</span>   └── test-file.R</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> testthat.R</span></code></pre></div></li>
<li><p>Most of these files/folders will be generated by <code>{devtools}</code> and <code>{usethis}</code>, but you should still know what they are.</p></li>
<li><p><code>.git</code> is a hidden directory that git uses to store your version control history. Don’t touch this.</p></li>
<li><p><code>.gitignore</code> is a hidden file used to tell git what files/folders to not place under version control. See the <a href="https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository#_ignoring">Pro Git Book</a>.</p></li>
<li><p><code>LICENSE</code> and <code>LICENSE.md</code> contain the license that your code is distributed under. Typical open-source licenses are <a href="https://opensource.org/licenses/MIT">MIT</a> and <a href="https://www.gnu.org/licenses/gpl-3.0">GPL-3</a>.</p></li>
<li><p>The <code>man</code> (for “manual”) folder contains files that hold your package’s documentation. E.g. whenever you use <code>help()</code> it uses information from a file in the <code>man</code> folder. This package has two functions which are documented <code>f1()</code> and <code>f2()</code>.</p></li>
<li><p><code>NAMESPACE</code> is a file that determines</p>
<ol style="list-style-type: lower-roman">
<li>What functions are available to the user of your package (versus what functions are for internal use only), and</li>
<li>What functions from other packages are you importing.</li>
</ol></li>
<li><p>The <code>R</code> folder contains R script files (ending in “.R”) that hold all of your R code.</p>
<ul>
<li>R code only goes in R scripts (ending in “.R”), <strong>not</strong> R Markdown Files (ending in “.Rmd”).</li>
</ul></li>
<li><p><code>.Rbuildignore</code> is a hidden file which tells R which files/folders to exclude from the package bundle. You use regular expressions to determine which files to ignore.</p>
<ul>
<li>E.g. if you have a website in your package folder, then you can exclude it from the bundle by placing that folder’s name in <code>.Rbuildignore</code>.</li>
<li>You typically just use <code>usethis::use_build_ignore()</code> to add files/folders to <code>.Rbuildignore</code>.</li>
</ul></li>
<li><p><code>README.md</code> is the file that other developers typically first look at, and it is the front page of your package’s GitHub website. <code>README.Rmd</code> is an R markdown file that generates <code>README.md</code>.</p></li>
<li><p><code>src</code> is a folder that contains C++ files (ending in “.cpp”).</p></li>
<li><p><code>tests</code> is a folder that contains R code for unit-tests, which are automatic checks that you write to determine if your R package works as you intend.</p></li>
</ul>
<div id="create-a-package-skeleton" class="section level2">
<h2>Create a package skeleton</h2>
<ul>
<li><p>You can create a package skeleton with the <code>usethis::create_package()</code>.</p></li>
<li><p>Before running this, change your working directory to where you want to create your R package with “Session &gt; Set Working Directory &gt; Choose Directory…”.</p></li>
<li><p>This will be the “source” state of the package, so you can choose it to be almost anywhere on your computer.</p></li>
<li><p>Choose a location that is not inside an RStudio project, another R package, another git repo, or inside an R library.</p></li>
<li><p>Then just type</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div></li>
<li><p>I don’t like RStudio projects, so I typically run</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>, <span class="at">rstudio =</span> <span class="cn">FALSE</span>, <span class="at">open =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>You can use RStudio Projects if you want. But I won’t help with any issues you have with RStudio projects.</p></li>
<li><p><strong>Exercise</strong>: For this lecture, we will create a simple R package called <code>forloop</code> that reproduces a lot of Base R functions using for-loops. Create a folder called “forloop”, set the working directory to this folder, and run</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">create_package</span>(<span class="at">path =</span> <span class="st">&quot;.&quot;</span>, <span class="at">rstudio =</span> <span class="cn">FALSE</span>, <span class="at">open =</span> <span class="cn">FALSE</span>)</span></code></pre></div></li>
</ul>
</div>
</div>
<div id="the-r-folder" class="section level1">
<h1>The R folder</h1>
<ul>
<li><p>Here, we will discuss how programming is a little different compared to working in an R script or an R Markdown file in interactive mode.</p></li>
<li><p>All R code in package should be a function definition (with <strong>very</strong> few exceptions).</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>fname <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">arg1 =</span> val1, <span class="at">arg2 =</span> val2, ...) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## code here</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(retval)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>Don’t have R code outside of a function definition in your package until you <strong>really</strong> understand the benefits of exceptions to this rule.</p></li>
<li><p>All R code should go in R scripts (ending in “.R”) <strong>not</strong> R markdowns (ending in “.Rmd”)</p></li>
<li><p>Use informative file names. Put only related R functions into the same file (e.g. a main function and some helpers).</p></li>
<li><p>As you add or modify function definitions, you should test interactively test them. That is, iteratively:</p>
<ol style="list-style-type: decimal">
<li>Use <code>devtools::load_all()</code> to load a source package into memory.</li>
<li>Play the function you are working on, edit it.</li>
<li>Repeat 1 and 2 until you are happy with the function.</li>
</ol></li>
<li><p>In a typical R script (outside of an R package), code is run when you run it. In an R package, code is run when the package is built. So, for example, if you include the following line of code in your package.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-17 09:18:12 EST&quot;</code></pre>
<p>Then <code>x</code> be the time of the package build. If you want the time that a user runs some code, include this statement in a function.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>ftime <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">Sys.time</span>())</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ftime</span>()</span></code></pre></div>
<pre><code>## [1] &quot;2022-01-17 09:18:12 EST&quot;</code></pre></li>
<li><p>When you alias a function from another package, don’t do</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> pkg<span class="sc">::</span>bar</span></code></pre></div>
<p>instead, do</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="cf">function</span>(...) pkg<span class="sc">::</span><span class="fu">bar</span>(...)</span></code></pre></div>
<p>This is since <code>foo</code> is defined as <code>pkg::bar</code> during build time of your package. So if the <code>{pkg}</code> maintainers fix an issue in <code>bar()</code>, your aliased function will still be the incorrect version of <code>bar()</code> until a user rebuilds your package.</p></li>
<li><p>Don’t modify a user’s R landscape (the global settings and the behavior of functions/objects outside of your package). With rare exceptions, here are some things to not do:</p>
<ul>
<li>Never use <code>setwd()</code>.</li>
<li>Never use <code>library()</code> or <code>require()</code>.
<ul>
<li>See below for using other packages in your package.</li>
</ul></li>
<li>Never use <code>source()</code>.
<ul>
<li>Use <code>devtools::load_all()</code> while developing a package (but <em>never</em> have <code>devtools::load_all()</code> in your package).</li>
</ul></li>
<li>Never change the options via <code>options()</code> or <code>par()</code>.</li>
<li>Never use <code>set.seed()</code> to alter the random number generation for a user.
<ul>
<li>Except possibly in examples, vignettes, and unit tests. But never in anything in the /R folder.</li>
</ul></li>
<li>Never use <code>Sys.setenv()</code> or <code>Sys.setlocale()</code>.</li>
</ul></li>
<li><p><strong>Exercise</strong>: Create an R script file in your package called “sum.R” via</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="at">name =</span> <span class="st">&quot;sum&quot;</span>)</span></code></pre></div>
<p>In this file, create a function called <code>sum2()</code> that takes as input a numeric vector <code>x</code> and returns its sum. Use a for-loop to calculate the sum (not the <code>sum()</code> function).</p></li>
<li><p><strong>Exercise</strong>: Include an <code>na.rm</code> argument that defaults to <code>FALSE</code>. It removes <code>NA</code>’s if <code>TRUE</code> and does not if <code>FALSE</code>.</p></li>
<li><p><strong>Exercise</strong>: Create a function called <code>count_na()</code> that will use a for-loop to count how many <code>NA</code>’s there are in a vector.</p></li>
<li><p><strong>Exercise</strong>: There are a couple edge cases you should worry about. If the length of <code>x</code> is 0, then you should return <code>NA_real_</code>. If all values of <code>x</code> are <code>NA</code>, then you should return <code>NA_real_</code> (use <code>count_na()</code> to check for this). Edit your function to make these changes now. Test it out on</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum2</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="do">## should be 1</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum2</span>(<span class="fu">c</span>(), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="do">## should be NA</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sum2</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="do">## should be NA</span></span></code></pre></div></li>
</ul>
</div>
<div id="documentation" class="section level1">
<h1>Documentation</h1>
<ul>
<li><p>Documentation: Describing:</p>
<ol style="list-style-type: decimal">
<li>What a function does.</li>
<li>What are the inputs of the function.</li>
<li>What are the outputs of the function.</li>
<li>Example usage of the function.</li>
</ol></li>
<li><p>Documentation is vital for</p>
<ol style="list-style-type: decimal">
<li>Maintaining packages (you will forget what your functions do)</li>
<li>Having other folks use your package (they need a way to learn the functions).</li>
</ol></li>
<li><p>You should be writing documentation while you are writing R code</p>
<ul>
<li><strong>Not</strong> only after the code is “done”.</li>
</ul></li>
<li><p>Documentation in an R package is in “.rd” files in the “man” folder. This is rather esoteric, so we’ll use <code>{roxygen2}</code> to generate them automatically.</p></li>
<li><p><code>{roxygen2}</code> documentation is provided by comments above a function, where each line begins with <code>#'</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Documentation goes here</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Function code here.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>After you write some documentation, you can run</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">document</span>()</span></code></pre></div>
<p>and <code>{roxygen2}</code> will automatically update your documentation.</p></li>
<li><p>You can then look at your documentation by using <code>?</code> or <code>help()</code>.</p></li>
<li><p><code>{roxygen2}</code> comments are formatted as tag-value pairs, where tags begin with an ampersand <code>@</code>.</p></li>
<li><p>Values of a tag extend from the tag to the next tag.</p></li>
<li><p>A typical <code>{roxygen2}</code> documentation looks like this</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @title One line description of what the function does.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @description One paragraph description of what the function does</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @details</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Long documentation, detailing exactly what the function does</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param arg1 What is arg1?</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param arg2 What is arg2?</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return What is returned?</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @author Your name</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @examples</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; ## Some example code goes here</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2) {</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Function code here</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p><code>@param</code>: Each argument should be documented. You should state</p>
<ol style="list-style-type: decimal">
<li>What is the format of the argument (character vector? data frame? numeric matrix?)</li>
<li>What affect the argument has on the function’s behavior.</li>
</ol></li>
<li><p><code>@examples</code>: Include a few lines of example R code. Do not use <code>@example</code> as this expects only one line.</p></li>
<li><p><code>@return</code>: What does your function return (numeric vector, character matrix, etc). Describe not just its type but what it is (posterior probabilities, summation, geometric means, etc)</p></li>
<li><p>Use <code>@inheritParams</code> to use the parameter documentation from a function in a different function.</p></li>
<li><p>The following will use <code>fn1()</code>’s documentation for <code>a</code> in <code>fn2()</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param a An argument</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>fn1 <span class="ot">&lt;-</span> <span class="cf">function</span>(a) {</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @inheritParams fn1</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param b Another argument</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>fn2 <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b) {</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>If you want to document your function, but do not want <code>{roxygen2}</code> to create a man file for it, then add the <code>@noRd</code> tag.</p></li>
<li><p>Documenting is very good, but having a manual page means that you need to maintain it for other users, so I usually document <strong>all</strong> of my functions but only have man pages for my exported functions.</p></li>
</ul>
<div id="formatting" class="section level2">
<h2>Formatting</h2>
<ul>
<li><p>Within <code>{roxygen2}</code> blocks, you can format your documentation with LaTeX-style code:</p></li>
<li><p><code>\emph{italics}</code>: italics.</p></li>
<li><p><code>\strong{bold}</code>: bold.</p></li>
<li><p><code>\code{fn()}</code>: formatted in-line code</p></li>
<li><p><code>\link{fn}: Link to the documentation of</code>fn()<code>. Do *not* include parentheses inside</code>`</p></li>
<li><p>I often do <code>\code{\link{fn}()}</code> when I link to a function so that it is both linked, code-formatted, and has a parentheses.</p></li>
<li><p>To link to functions in other packages, use <code>\link[pkg]{fn}</code></p></li>
<li><p><code>\url{}</code>: Include a URL.</p></li>
<li><p><code>\href{www}{word}</code>: Provide a hyperlink.</p></li>
<li><p><code>\email{}</code>: Provide an email.</p></li>
<li><p><code>\doi{}</code>: Provide the DOI of a paper (with a link to that paper).</p></li>
<li><p>You can make an itemized list with</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \itemize{</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item Item 1</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item Item 2</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span></code></pre></div></li>
<li><p>You can make an enumerated list with</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \enumerate{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item Item 1</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item Item 2</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span></code></pre></div></li>
<li><p>You can make a named list with</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \describe{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{Name 1}{Item 1}</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{Name 2}{Item 2}</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span></code></pre></div></li>
<li><p><strong>Exercise</strong>: Document <code>sum2()</code> and <code>count_na()</code>. Make sure to include the following tags <code>@title</code>, <code>@description</code>, <code>@details</code>, <code>@param</code>, <code>@return</code>, <code>@author</code>, and <code>@examples</code>.</p></li>
<li><p><strong>Exercise</strong>: In the <code>@seealso</code> tag, provide a link to each function. Also provide a link to <code>base::sum()</code>. Use an itemized list.</p></li>
</ul>
</div>
</div>
<div id="namespace" class="section level1">
<h1>Namespace</h1>
<ul>
<li><p>A namespace tells R what functions come from what packages.</p></li>
<li><p>Each package has a namespace. You use <code>::</code> to tell R which package to use a function from. Otherwise, it wouldn’t know to distinguish between, e.g.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">lag</span>()</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">::</span><span class="fu">lag</span>()</span></code></pre></div></li>
<li><p>Your package namespace will determine</p>
<ol style="list-style-type: decimal">
<li>From what packages are you importing which functions?</li>
<li>What functions are you exporting to users?</li>
</ol></li>
</ul>
<div id="exporting" class="section level2">
<h2>Exporting</h2>
<ul>
<li><p>Include the following tag in the documentation of any function that you want a user to have access to.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="sc">@</span>export</span></code></pre></div></li>
<li><p>This will add the function to the “NAMESPACE” file (which you should not edit by hand).</p></li>
<li><p>Note <code>devtools::load_all()</code> will attach all functions from your package so you can test them out. But if a user installs your package and uses <code>library()</code>, they will <em>only</em> have access to exported functions.</p></li>
<li><p>You should <strong>only</strong> export functions you want others to use.</p></li>
<li><p>Exporting a function means that you have to be very wary about changing it in future versions since that might break other folks’ code.</p></li>
<li><p><strong>Exercise</strong>: Look at the “NAMESPACE” file in <code>{forloop}</code>. Now export all of your functions in <code>{forloop}</code>. Look at the “NAMESPACE” file again.</p></li>
</ul>
</div>
<div id="importing" class="section level2">
<h2>Importing</h2>
<ul>
<li><p><strong>Never</strong> use <code>library()</code> or <code>require()</code> in an R package.</p></li>
<li><p>Package dependencies go in the DESCRIPTION folder. You can tell R that your package depends on another package by running:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_package</span>()</span></code></pre></div></li>
<li><p>This will make it so that the package is available when your package is installed.</p></li>
<li><p>Then, you call functions from other packages via <code>package::function()</code>, where <code>package</code> is the name of the package and <code>function()</code> is the function name from <code>package</code>.</p></li>
<li><p>You can suggest (but not require) a package to be installed. This is usually done if the functions from the suggested package are not vital, or the suggested package is hard to install (or has a lot of dependencies itself). To do so, also use <code>usethis::use_package()</code> with <code>type = "Suggests"</code>.</p></li>
<li><p>If you suggest a package, whenever you use a function from that package you should first check to see if it is installed with <code>requireNamespace("pkg", quietly = TRUE)</code>. E.g.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">&quot;pkg&quot;</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  pkg<span class="sc">::</span><span class="fu">fun</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
</ul>
</div>
<div id="technical-notes-on-importing" class="section level2">
<h2>Technical notes on importing</h2>
<ul>
<li><p>Importing functions from a package is different than including a package in the “Imports” field of the DESCRIPTION file.</p>
<ul>
<li>Importing a function attaches it so that you do not need to use <code>::</code>.</li>
<li>Including a package in the Imports field makes sure the package is installed.</li>
</ul></li>
<li><p>The importing part of a namespace is important to avoid ambiguity.</p></li>
<li><p>E.g. many packages use <code>c()</code>. We can (rather foolishly) redefine it via</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Don&#39;t run this</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>c <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>and no package will be affected because they all import <code>c()</code> from the <code>{base}</code> R package.</p></li>
<li><p><strong>Search Path</strong>: The list of packages that R will automatically search for functions. See your search path by <code>search()</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">search</span>()</span></code></pre></div>
<pre><code>## [1] &quot;.GlobalEnv&quot;        &quot;package:stats&quot;     &quot;package:graphics&quot; 
## [4] &quot;package:grDevices&quot; &quot;package:utils&quot;     &quot;package:datasets&quot; 
## [7] &quot;package:methods&quot;   &quot;Autoloads&quot;         &quot;package:base&quot;</code></pre></li>
<li><p><strong>Loading a package</strong>: Put a package in memory, but do not put it in the search path. You can then use the function by using <code>::</code> as in <code>dplyr::mutate()</code>. If you call a function via <code>::</code> then it will load that package automatically.</p></li>
<li><p><strong>Attaching a package</strong>: Both load a package and place it in the search path, so you don’t need to use <code>::</code> to call a function from that package. This is what <code>library()</code> does.</p></li>
<li><p>If you import a package (via the DESCRIPTION file), then it loads it, it does not attach it, so you need to use <code>::</code>.</p></li>
<li><p>If you import a function (via the namespace), then it attaches it, so you do not need to use <code>::</code>.</p></li>
<li><p>Generally, I do not recommend importing functions. but you can do it by using <code>@importFrom</code> anywhere in your package.</p></li>
<li><p>E.g. adding this line anywhere in your package will attach <code>dplyr::mutate()</code> whenever your package is attached.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @importFrom dplyr mutate</span></span></code></pre></div></li>
<li><p>Why do I recommend rarely using <code>@importFrom</code>? Because that could make coding more complicated for your users</p>
<ul>
<li>E.g. if you import <code>dplyr::lag()</code> then when a user attached your package, R will now think <code>lag()</code> comes from <code>{dplyr}</code> and not <code>{stats}</code>, which could break the user’s code.</li>
</ul></li>
</ul>
</div>
<div id="practical-suggestions" class="section level2">
<h2>Practical suggestions</h2>
<ul>
<li><p>You should try to have as few dependencies as possible. When packages change, that can affect (or break) your package, which means more work on your part to maintain your package.</p></li>
<li><p>Try to avoid dependencies on new packages or on packages from folks who do not have a history of maintaining their packages.</p></li>
<li><p>Try to avoid dependencies on packages from the tidyverse (dplyr, tidyr, etc). These packages have changed frequently in the past. The maintainers are great about notifying folks about breaking changes, but it still means more work on your part.</p>
<ul>
<li>E.g., if you only use string manipulation in one spot in your package, try using <code>grepl()</code> instead of <code>stringr::str_detect()</code>.</li>
</ul></li>
<li><p>Here is a list of nice essays on limiting dependencies: <a href="https://www.tinyverse.org/" class="uri">https://www.tinyverse.org/</a></p></li>
<li><p>If you do import functions from other packages, put all of those <code>{roxygen2}</code> tags in the same location in one file.</p></li>
<li><p><strong>Exercise</strong>: Instead of using <code>count_na()</code>, you decide to use the <code>n_na()</code> function from the <code>{na.tools}</code> package. Make these edits to your package now.</p></li>
<li><p><strong>Exercise</strong>: Now import <code>n_na()</code> and remove your use of <code>::</code> from the previous exercise.</p></li>
</ul>
</div>
</div>
<div id="description-file" class="section level1">
<h1>DESCRIPTION file</h1>
<ul>
<li><p>The file called “DESCRIPTION” (with no filename extension) contains “meta” information about your package (like the authors, the dependencies, the license, etc)</p></li>
<li><p><code>usethis::create_package()</code> gives you a template for DESCRIPTION which you can fill in. Most of the options are self-explanatory.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Package</span><span class="kw">:</span><span class="at"> mypackage</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Title</span><span class="kw">:</span><span class="at"> What The Package Does (one line, title case required)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Version</span><span class="kw">:</span><span class="at"> </span><span class="fl">0.1</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Authors@R</span><span class="kw">:</span><span class="at"> person(&quot;First&quot;, &quot;Last&quot;, email = &quot;first.last@example.com&quot;,</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="at">                  role = c(&quot;aut&quot;, &quot;cre&quot;))</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Description</span><span class="kw">:</span><span class="at"> What the package does (one paragraph)</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Depends</span><span class="kw">:</span><span class="at"> R (&gt;= 3.1.0)</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">License</span><span class="kw">:</span><span class="at"> What license is it under?</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">LazyData</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span></code></pre></div></li>
<li><p>Each line consists of a <strong>field</strong> and a <strong>value</strong>, separated by colon. For example, above the “Package” field has the value “mypackage”.</p></li>
<li><p>“Package”: Choose a package name that is</p>
<ol style="list-style-type: decimal">
<li>Only letters,</li>
<li>All lower-case,</li>
<li>Relatively short,</li>
<li>Unique (e.g. don’t choose “google” as your package name).</li>
</ol></li>
<li><p>“Title”: In less than 65 characters, in title case, describe what your package does. Must be in title case and cannot end in a period.</p></li>
<li><p>“Description”: A paragraph of what the package does. Each line should be less than 80 characters long and each newline should be indented by 4 white spaces.</p>
<ul>
<li>There are a lot of things CRAN wants formatted for a Description section of the DESCRIPTION file. See <a href="https://cran.r-project.org/web/packages/submission_checklist.html">Checklist for CRAN Submissions</a>.</li>
</ul></li>
<li><p>“<a href="mailto:Authors@R" class="email">Authors@R</a>:” This field contains executable R code. See the helpfile for <code>person()</code>.</p>
<ul>
<li><p>The <code>first</code> and <code>last</code> arguments are the first and last names of the person.</p></li>
<li><p>The <code>email</code> should be the email of the individual.</p></li>
<li><p>The <code>role</code> should be a vector containing possible values of <code>"aut"</code> for author, <code>"cre"</code> for creator/maintainer (one one person should be <code>"cre"</code>), <code>"ctb"</code> for contributor (only providing minor edits). There are other roles that are possible.</p></li>
<li><p>The <code>comment</code> argument is a named character vector with additional notes. The most common value of <code>comment</code> is your <a href="https://orcid.org/">ORCID</a> number with <code>comment = c(ORCID = "number here")</code>.</p></li>
<li><p>If you have more than one author, put the <code>person()</code> calls in a vector.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="at">Authors@R</span><span class="fu">:</span><span class="kw">:</span><span class="at"> c(person(&quot;Jane&quot;, &quot;Doe&quot;, email = &quot;janedoe@american.edu&quot;, role = c(&quot;aut&quot;, &quot;cre&quot;)),</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="at">              person(&quot;John&quot;, &quot;Doe&quot;, email = &quot;johndoe@american.edu&quot;, role = c(&quot;aut&quot;)))</span></span></code></pre></div></li>
</ul></li>
<li><p>“License”: What license should you distribute this package under? Don’t edit this by hand. You should use either (in decreasing order of restrictiveness)</p>
<ul>
<li><p>Proprietary license: No one can use your package (CRAN won’t except this)</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_proprietary_license</span>()</span></code></pre></div></li>
<li><p>GPL-3 license: If other folks make derivatives of your package, they have to also place it as open-source under a GPL-3 license:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_gpl3_license</span>()</span></code></pre></div></li>
<li><p>MIT license: Folks can use your stuff as long they distribute the license with your code.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_mit_license</span>()</span></code></pre></div></li>
<li><p>CC0 license: You place your stuff in the public domain, and anyone can use it for any reason.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_cc0_license</span>()</span></code></pre></div></li>
</ul></li>
<li><p>“Version”: At least two integers separated by dots (.) or dashes (-) like <code>1.0.2</code> or <code>1.0-11</code>. You should usually only have three integers (at most).</p>
<ul>
<li>I would recommend just sticking to exactly three integers, separated by dots.</li>
<li>The first integer is the “major release”.</li>
<li>The second integer is the “minor release”.</li>
<li>The third integer is the “bug fixes”.</li>
<li>You change a version number when you feel that you have a completed version of the package.</li>
<li>Only increment version numbers up (that is, if you are on version <code>1.0.1</code>, don’t change it to <code>0.9.0</code>.</li>
</ul></li>
<li><p>“Imports”: What packages does your package depend on? If you run <code>usethis::use_package()</code>, then <code>{usethis}</code> will edit the DESCRIPTION file for you. But typically the imports field looks something like this</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Imports</span><span class="kw">:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="at">  pkg1,</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="at">  pkg2</span></span></code></pre></div></li>
<li><p>“Suggests”: What packages do you suggest installing to use your package (but are not required)? Again, use <code>usethis::use_package()</code>, but this time with the <code>Type = "Suggests"</code> argument. It will look like this in the DESCRIPTION folder:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Suggests</span><span class="kw">:</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="at">  pkg1,</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="at">  pkg2</span></span></code></pre></div></li>
<li><p><strong>Exercise</strong>: Edit the “Package”, “Title”, “<a href="mailto:Authors@R" class="email">Authors@R</a>” and “Description” sections of your “DESCRIPTION” file</p></li>
<li><p><strong>Exercise</strong>: Use a GPL-3 license.</p></li>
</ul>
</div>
<div id="workflow" class="section level1">
<h1>Workflow</h1>
<ul>
<li><p>Keep working directory at all times at top level of your R package.</p></li>
<li><p>Iterate the following until done:</p>
<ol style="list-style-type: decimal">
<li>Tweak a function</li>
<li>Update documentation (if necessary)</li>
<li>Run <code>devtools::document()</code> (if you’ve made any changes that impact help files or NAMESPACE)
<ul>
<li>Or run <code>devtools::load_all()</code> if you haven’t made those changes.</li>
</ul></li>
<li>Run some examples interactively.</li>
<li>Run <code>devtools::test()</code></li>
<li>Run <code>devtools::check()</code></li>
</ol></li>
<li><p><code>load_all()</code> is how we can load a source package into memory. This will load all functions (both exported and non-exported).</p></li>
</ul>
</div>
<div id="including-datasets" class="section level1">
<h1>Including Datasets</h1>
<div id="external-data" class="section level2">
<h2>External data</h2>
<ul>
<li><p>External data is available to the user. For example, the <code>mpg</code> dataset from the <code>{ggplot2}</code> is available to us by running</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;mpg&quot;</span>, <span class="at">package =</span> <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mpg)</span></code></pre></div>
<pre><code>## tibble [234 × 11] (S3: tbl_df/tbl/data.frame)
##  $ manufacturer: chr [1:234] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ...
##  $ model       : chr [1:234] &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; ...
##  $ displ       : num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
##  $ year        : int [1:234] 1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
##  $ cyl         : int [1:234] 4 4 4 4 6 6 6 4 4 4 ...
##  $ trans       : chr [1:234] &quot;auto(l5)&quot; &quot;manual(m5)&quot; &quot;manual(m6)&quot; &quot;auto(av)&quot; ...
##  $ drv         : chr [1:234] &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
##  $ cty         : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...
##  $ hwy         : int [1:234] 29 29 31 30 26 26 27 26 25 28 ...
##  $ fl          : chr [1:234] &quot;p&quot; &quot;p&quot; &quot;p&quot; &quot;p&quot; ...
##  $ class       : chr [1:234] &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; ...</code></pre></li>
<li><p>To include data in a package, simply add it, in the format of an RData file, in a directory called “data”.</p></li>
<li><p>You can use <code>usethis::use_data()</code> to save a dataset in the “data” directory. The first argument is the data you want to save.</p></li>
<li><p>You should document your dataset, using roxygen, in a separate R file in the “R” directory. Typically, folks document all of their data in “R/data.R”.</p></li>
<li><p>Instead of a function declaration, you just type the name of the dataset. E.g., from my <code>{updog}</code> R package I have the following documentation for the <code>snpdat</code> tibble.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @title GBS data from Shirasawa et al (2017)</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @description Contains counts of reference alleles and total read counts </span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; from the GBS data of Shirasawa et al (2017) for</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; the three SNPs used as examples in Gerard et. al. (2018).</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @format A \code{tibble} with 419 rows and 4 columns:</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \describe{</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     \item{id}{The identification label of the individuals.}</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     \item{snp}{The SNP label.}</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     \item{counts}{The number of read-counts that support the reference allele.}</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;     \item{size}{The total number of read-counts at a given SNP.}</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @source \doi{10.1038/srep44207}</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @references</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; \itemize{</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{Shirasawa, Kenta, Masaru Tanaka, Yasuhiro Takahata, Daifu Ma, Qinghe Cao, Qingchang Liu, Hong Zhai, Sang-Soo Kwak, Jae Cheol Jeong, Ung-Han Yoon, Hyeong-Un Lee, Hideki Hirakawa, and Sahiko Isobe &quot;A high-density SNP genetic map consisting of a complete set of homologous groups in autohexaploid sweetpotato (Ipomoea batatas).&quot; \emph{Scientific Reports 7} (2017). \doi{10.1038/srep44207}}</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;   \item{Gerard, D., Ferrão, L. F. V., Garcia, A. A. F., &amp; Stephens, M. (2018). Genotyping Polyploids from Messy Sequencing Data. \emph{Genetics}, 210(3), 789-807. \doi{10.1534/genetics.118.301468}.}</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; }</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;snpdat&quot;</span></span></code></pre></div></li>
<li><p>Never export a dataset (via the <code>@export</code> tag).</p></li>
<li><p>The <code>@format</code> tag is useful for describing how the data are structured.</p></li>
<li><p>The <code>@source</code> tag is useful to describe the URL/papers/collection process for the data.</p></li>
</ul>
</div>
<div id="internal-data" class="section level2">
<h2>Internal Data</h2>
<ul>
<li><p>To use pre-computed data, you place all internal data in the “R/sysdata.rda” file.</p></li>
<li><p><code>usethis::use_data()</code> will do this automatically if you use the <code>internal = TRUE</code> argument.</p></li>
<li><p>E.g. the following will put <code>x</code> and <code>y</code> in “R/sysdata.rda”</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">hello =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="at">goodbye =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(x, y, <span class="at">internal =</span> <span class="cn">TRUE</span>)</span></code></pre></div></li>
<li><p>You can use internal data in a package as you normally would use an object that is loaded into memory.</p></li>
<li><p><strong>Exercise</strong>: Create a function called <code>fib()</code> that takes as input <code>n</code> and returns the <code>n</code>th <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci number</a>. Recall that the sequence is <span class="math display">\[
  0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, \ldots
  \]</span> where the next number is the sum of the previous two numbers. Put this function in a new R script file (called “fib.R”) and make sure your function is well documented.</p></li>
<li><p><strong>Exercise</strong>: Save the first 1000 Fibonacci numbers as a vector for internal data. Then create a function called <code>fib1000()</code> that just looks up the <code>n</code>th Fibonacci number from this internal vector.</p></li>
</ul>
</div>
</div>

<!DOCTYPE html>
<hr>
<a href="https://nsf.gov/awardsearch/showAward?AWD_ID=2132247"><img src="https://dcgerard.github.io/advancedr/nsf_logo.png" alt="National Science Foundation Logo" height="48px"/></a>
<a href="https://www.american.edu/cas/mathstat/"><img src="https://dcgerard.github.io/advancedr/au_logo.png" alt="American University Logo" height="48px"/></a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
