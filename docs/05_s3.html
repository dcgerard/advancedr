<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="David Gerard" />

<meta name="date" content="2022-01-26" />

<title>S3 Objects</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<link rel="shortcut icon" href="https://dcgerard.github.io/advancedr/au_logo_small.png" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Teaching Website for Advanced R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dcgerard/advancedr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">S3 Objects</h1>
<h4 class="author">David Gerard</h4>
<h4 class="date">2022-01-26</h4>

</div>

<div id="TOC">
<ul>
<li><a href="#learning-objectives">Learning Objectives</a></li>
<li><a href="#motivation">Motivation</a></li>
<li><a href="#s3-basics">S3 Basics</a></li>
<li><a href="#classes">Classes</a>
<ul>
<li><a href="#constructor">Constructor</a></li>
<li><a href="#validator">Validator</a></li>
<li><a href="#helpers">Helpers</a></li>
</ul></li>
<li><a href="#generics">Generics</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#the-design-of-an-s3-object">The Design of an S3 Object</a></li>
<li><a href="#inheritance">Inheritance</a>
<ul>
<li><a href="#next-method">Next Method</a></li>
</ul></li>
<li><a href="#example-simulation">Example: Simulation</a></li>
<li><a href="#new-functions">New functions</a></li>
</ul>
</div>

<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="learning-objectives" class="section level1">
<h1>Learning Objectives</h1>
<ul>
<li>Chapter 13 of <a href="https://adv-r.hadley.nz/">Advanced R</a>
<ul>
<li>Most notes taken from Hadley’s book. Thank you so much.</li>
</ul></li>
<li><a href="https://vctrs.r-lib.org/articles/s3-vector.html"><code>{vctrs}</code></a> package</li>
</ul>
</div>
<div id="motivation" class="section level1">
<h1>Motivation</h1>
<ul>
<li><p>S3 is the most commonly used object-oriented programming (OOP) system in R.</p></li>
<li><p>Most of the common data types you are used to are S3.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data frames are S3</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(mtcars)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tibbles are S3</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mt_tb <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(mtcars)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(mt_tb)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lm objects are S3</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>lmout <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(lmout) </span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot2 plots are S3</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>pl <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(mtcars, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(pl)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidymodels use S3</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>tdout <span class="ot">&lt;-</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  parsnip<span class="sc">::</span><span class="fu">fit</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(tdout)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Factors are S3</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dates are S3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">make_date</span>(<span class="at">year =</span> <span class="dv">1970</span>, <span class="at">month =</span> <span class="dv">1</span>, <span class="at">day =</span> <span class="dv">1</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre></li>
<li><p>If you are creating a package and you want OOP features, you should use S3 unless</p>
<ol style="list-style-type: decimal">
<li>You work in a large team (use S4 then).</li>
<li>Modify-by-reference is important (use R6).</li>
</ol></li>
<li><p>This is since most R programmers are used to S3 (intuitively) and are not used to S4 or R6.</p></li>
</ul>
</div>
<div id="s3-basics" class="section level1">
<h1>S3 Basics</h1>
<ul>
<li><p>An S3 object is any variable with a <code>class</code> attribute. This is the full definition.</p></li>
<li><p>S3 objects may or may not have more attributes.</p></li>
<li><p>E.g. the <code>factor</code> class always has the <code>levels</code> attribute.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;A&quot;</span>))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(x)</span></code></pre></div>
<pre><code>## $levels
## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;
## 
## $class
## [1] &quot;factor&quot;</code></pre></li>
<li><p>You can get the underlying base type by <code>unclass()</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unclass</span>(x)</span></code></pre></div>
<pre><code>## [1] 1 2 2 1 3 1
## attr(,&quot;levels&quot;)
## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</code></pre></li>
<li><p>Functions can be S3 objects as well as long as they have the <code>class</code> attribute.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sout <span class="ot">&lt;-</span> <span class="fu">stepfun</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(sout)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(sout)</span></code></pre></div>
<pre><code>## [1] &quot;stepfun&quot;  &quot;function&quot;</code></pre></li>
<li><p>S3 objects behave differently when passed to a <strong>generic</strong> function.</p></li>
<li><p>Use <code>sloop::ftype()</code> to see if a function is generic.</p></li>
<li><p>These are all generics</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(print)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;      &quot;generic&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(summary)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;      &quot;generic&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(plot)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;      &quot;generic&quot;</code></pre></li>
<li><p>But these are not:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(sum)</span></code></pre></div>
<pre><code>## [1] &quot;primitive&quot; &quot;generic&quot;</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(c)</span></code></pre></div>
<pre><code>## [1] &quot;primitive&quot; &quot;generic&quot;</code></pre></li>
<li><p>Generic functions behave differently depending on the class of the object.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(mt_tb)</span></code></pre></div>
<pre><code>## # A tibble: 32 × 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # … with 22 more rows</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lmout)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ wt, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt  
##       37.29        -5.34</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pl)</span></code></pre></div>
<p><img src="05_s3_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;" /></p></li>
<li><p>This is <em>not</em> implemented by <code>if</code>-<code>else</code> statements. That would be inefficient because only the authors of <code>print()</code> (i.e. the R Core team) could add new functionality to new S3 objects. The idea of using generic functions allows us (new developers) to define new functionality to the same generics.</p></li>
<li><p>The implementation of a generic for a specific class is called a <strong>method</strong>.</p></li>
<li><p>The act of choosing a method from a generic is called <strong>method dispatch</strong>. Use <code>sloop::s3_dispatch()</code> to see this process.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">print</span>(mt_tb))</span></code></pre></div>
<pre><code>##    print.tbl_df
## =&gt; print.tbl
##  * print.data.frame
##  * print.default</code></pre>
<ul>
<li>The <code>*</code> means the method exists but is not used.</li>
<li>The <code>=&gt;</code> means the method exists and is used.</li>
<li>So above, it found a method for the <code>tbl_df</code> class and used it, so it did not go on to look for other methods (for objects of class <code>tbl</code>, <code>data.frame</code> or the <code>default</code> method).</li>
</ul></li>
<li><p>Below there is no <code>aperm()</code> method for matrices, integers, or numerics, so it used the defualt one, which is for arrays.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">ncol =</span> <span class="dv">3</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">aperm</span>(mat, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>)))</span></code></pre></div>
<pre><code>##    aperm.matrix
##    aperm.integer
##    aperm.numeric
## =&gt; aperm.default</code></pre></li>
<li><p>You can access specific methods by <code>generic.class()</code>. E.g.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>stats<span class="sc">:::</span><span class="fu">print.lm</span>(lmout)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = mpg ~ wt, data = mtcars)
## 
## Coefficients:
## (Intercept)           wt  
##       37.29        -5.34</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aperm.default</span>(mat, <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    2    3    4
## [2,]    5    6    7    8
## [3,]    9   10   11   12</code></pre></li>
<li><p>But these are often not exported and should generally <strong>not</strong> be accessed directly by the user, or other developers.</p></li>
<li><p>Lots of methods have <code>.</code> in the middle. But not all functions with <code>.</code> are methods. E.g. <code>read.csv()</code> and <code>t.test()</code> are not methods of generic functions. <code>read.csv()</code> is just a function with a dot in the name, and <code>t.test()</code> is just a generic function with a dot in the name. These functions were created before S3, which is why they are named poorly.</p></li>
<li><p>You can confirm that a function with a <code>.</code> in it is a method also with <code>sloop::ftype()</code>.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(read.csv)</span></code></pre></div>
<pre><code>## [1] &quot;function&quot;</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">ftype</span>(t.test)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;      &quot;generic&quot;</code></pre></li>
<li><p>Because of this, you should never name variables are functions with a dot in them.</p></li>
<li><p>To find all of the methods of a generic, use <code>sloop::s3_methods_generic()</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_methods_generic</span>(<span class="st">&quot;print&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 309 × 4
##    generic class       visible source             
##    &lt;chr&gt;   &lt;chr&gt;       &lt;lgl&gt;   &lt;chr&gt;              
##  1 print   acf         FALSE   registered S3method
##  2 print   AES         FALSE   registered S3method
##  3 print   all_vars    FALSE   registered S3method
##  4 print   anova       FALSE   registered S3method
##  5 print   ansi_string FALSE   registered S3method
##  6 print   ansi_style  FALSE   registered S3method
##  7 print   any_vars    FALSE   registered S3method
##  8 print   aov         FALSE   registered S3method
##  9 print   aovlist     FALSE   registered S3method
## 10 print   ar          FALSE   registered S3method
## # … with 299 more rows</code></pre></li>
<li><p>To find all methods for a class, use <code>sloop::s3_methods_class()</code>.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_methods_class</span>(<span class="st">&quot;data.frame&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 55 × 4
##    generic       class      visible source
##    &lt;chr&gt;         &lt;chr&gt;      &lt;lgl&gt;   &lt;chr&gt; 
##  1 [             data.frame TRUE    base  
##  2 [[            data.frame TRUE    base  
##  3 [[&lt;-          data.frame TRUE    base  
##  4 [&lt;-           data.frame TRUE    base  
##  5 $&lt;-           data.frame TRUE    base  
##  6 aggregate     data.frame TRUE    stats 
##  7 anyDuplicated data.frame TRUE    base  
##  8 anyNA         data.frame TRUE    base  
##  9 as.data.frame data.frame TRUE    base  
## 10 as.list       data.frame TRUE    base  
## # … with 45 more rows</code></pre></li>
<li><p><strong>Exercise</strong>: Explain the difference between each of the dots in <code>as.data.frame.data.frame()</code>. How would you typically use this method? Include in your discussion calls from the functions in the <code>{sloop}</code> package.</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><p><code>mean()</code> is an S3 generic. What classes have a method for <code>mean()</code>. What is the difference between them?</p></li>
<li><p>(Advanced R): What class of object does the following code return? What base type is it built on? What attributes does it use?</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">21</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">ecdf</span>(<span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">10</span>))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## Empirical CDF 
## Call: ecdf(rpois(100, 10))
##  x[1:14] =   4,   5,   6,  ...,  16,  17</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;ecdf&quot;     &quot;stepfun&quot;  &quot;function&quot;</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;closure&quot;</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(x)</span></code></pre></div>
<pre><code>## $class
## [1] &quot;ecdf&quot;     &quot;stepfun&quot;  &quot;function&quot;
## 
## $call
## ecdf(rpois(100, 10))</code></pre></li>
<li><p>(Advanced R): What class of object does the following code return? What base type is it built on? What attributes does it use?</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">rpois</span>(<span class="dv">100</span>, <span class="dv">5</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## 
##  1  2  3  4  5  6  7  8  9 10 12 
##  1 11 17 13 11 22  8 11  4  1  1</code></pre></li>
</ol>
</div>
<div id="classes" class="section level1">
<h1>Classes</h1>
<ul>
<li><p>Again, an S3 object is <em>any</em> object with a class attribute, that you can create with:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create and assign class in one step</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">structure</span>(<span class="fu">list</span>(), <span class="at">class =</span> <span class="st">&quot;my_class&quot;</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create, then set class</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x) <span class="ot">&lt;-</span> <span class="st">&quot;my_class&quot;</span></span></code></pre></div></li>
<li><p>You can get the class attribute by <code>class()</code> (as long as it is S3).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;my_class&quot;</code></pre></li>
<li><p>You can test that an object is a certain class by <code>inherits()</code>.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mtcars)</span></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(mtcars, <span class="st">&quot;data.frame&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(mtcars, <span class="st">&quot;tibble&quot;</span>)</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mt_tb <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(mtcars)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(mt_tb, <span class="st">&quot;tbl_df&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inherits</span>(mt_tb, <span class="st">&quot;data.frame&quot;</span>)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre></li>
<li><p>R has no checks that the structure of the class is as you intended. E.g., we can change the “data.frame” class to <code>"Date"</code> and bad things will happen (i.e. R will try to use the wrong generics on the data).</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mt_tb) <span class="ot">&lt;-</span> <span class="st">&quot;Date&quot;</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>mt_tb</span></code></pre></div>
<pre><code>## Error in as.POSIXlt.Date(x): &#39;list&#39; object cannot be coerced to type &#39;double&#39;</code></pre></li>
<li><p>You have to be careful about enforcing the correct structure on your class. For any S3 class you create, you should create 3 functions to help others build and validate your class:</p>
<ul>
<li>A <strong>constructor</strong> to makes a new object with your class, for internal use only.</li>
<li>A <strong>validator</strong> that checks the structure of objects with your class.</li>
<li>A <strong>helper</strong> that allows users to create objects of your class.</li>
</ul></li>
</ul>
<div id="constructor" class="section level2">
<h2>Constructor</h2>
<ul>
<li><p>Your constructor should</p>
<ul>
<li>Be called <code>new_myclass()</code>, replacing “myclass” with the name of your class.</li>
<li>Have one argument for the base object (e.g. list, numeric vector, etc).</li>
<li>Check the type of the base object and types of each attribute.</li>
</ul></li>
<li><p>E.g. if we were to create our own class to recapitulate factors, called <code>factor2</code>, we would do</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>new_factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">integer</span>(), <span class="at">levels =</span> <span class="fu">character</span>()) {</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.integer</span>(x))</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.character</span>(levels))</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">structure</span>(x,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">levels =</span> levels,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">class =</span> <span class="st">&quot;factor2&quot;</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>We can construct a factor as follows</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">new_factor2</span>(<span class="fu">c</span>(1L, 1L, 2L, 1L, 1L), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] 1 1 2 1 1
## attr(,&quot;levels&quot;)
## [1] &quot;A&quot; &quot;B&quot;
## attr(,&quot;class&quot;)
## [1] &quot;factor2&quot;</code></pre></li>
</ul>
</div>
<div id="validator" class="section level2">
<h2>Validator</h2>
<ul>
<li><p>Making sure the structure of an object is what you would expect is expensive.</p></li>
<li><p>E.g., we need to make sure that the number of unique values in a factor is at most the number of levels in that factor.</p></li>
<li><p>Validator functions should:</p>
<ol style="list-style-type: decimal">
<li>Be named <code>validator_myclass()</code>.</li>
<li>Take as input just an object from your class.</li>
<li>Include a bunch of assertions testing the structure of the inputted object.</li>
<li>Return the original object.</li>
</ol></li>
<li><p>Let’s make a validator for <code>factor2</code>.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>validate_factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">inherits</span>(x, <span class="st">&quot;factor2&quot;</span>))</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  values <span class="ot">&lt;-</span> <span class="fu">unclass</span>(x)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  levels <span class="ot">&lt;-</span> <span class="fu">attr</span>(x, <span class="st">&quot;levels&quot;</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(levels) <span class="sc">&lt;</span> <span class="fu">max</span>(values)) {</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;There must be at least as many `levels` as possible values in `x`&quot;</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">validate_factor2</span>(x)</span></code></pre></div>
<pre><code>## [1] 1 1 2 1 1
## attr(,&quot;levels&quot;)
## [1] &quot;A&quot; &quot;B&quot;
## attr(,&quot;class&quot;)
## [1] &quot;factor2&quot;</code></pre></li>
</ul>
</div>
<div id="helpers" class="section level2">
<h2>Helpers</h2>
<ul>
<li><p>A helper function is a user-facing function that will</p>
<ol style="list-style-type: decimal">
<li>Be called <code>myclass()</code>.</li>
<li>Call first the contructor function, then the validator function.</li>
<li>Be user friendly.
<ul>
<li>Good defaults.</li>
<li>Accepts multiple types for the base object and coerces intelligently.</li>
</ul></li>
</ol></li>
<li><p>Let’s do this for <code>factor2</code>.</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x =</span> <span class="fu">character</span>(), <span class="at">levels =</span> <span class="fu">unique</span>(x)) {</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">match</span>(x, levels)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">validate_factor2</span>(<span class="fu">new_factor2</span>(ind, levels)))</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="fu">factor2</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 1 2 2 1
## attr(,&quot;levels&quot;)
## [1] &quot;A&quot; &quot;B&quot;
## attr(,&quot;class&quot;)
## [1] &quot;factor2&quot;</code></pre></li>
<li><p>Side note: <code>match()</code> is a useful function. It will provide the positions of the second argument that match the values in the second argument. E.g.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">match</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 1 1 2 1 2</code></pre></li>
<li><p><strong>Exercise</strong> (Advanced R): Write a constructor for data.frame objects, but call it a <code>dataframe</code>. What base type is a data frame built on? What attributes does it use? What are the restrictions placed on the individual elements? What about the names?</p></li>
</ul>
</div>
</div>
<div id="generics" class="section level1">
<h1>Generics</h1>
<ul>
<li><p>A generic function is just one that performs method dispatch. Method dispatch is implemented through <code>UseMethod()</code>, so it is really easy to create a new generic.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>mygeneric <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">UseMethod</span>(<span class="st">&quot;mygeneric&quot;</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>No arguments are passed to <code>UseMethod()</code>.</p></li>
<li><p>The <code>x</code> is a required argument that all methods must have.</p></li>
<li><p>The <code>...</code> allows methods of your generic to include other variables than just <code>x</code>.</p></li>
<li><p>This is literally what most generic function definitions look like.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>mean</span></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;mean&quot;)
## &lt;bytecode: 0x560a2731cec0&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>print</span></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;print&quot;)
## &lt;bytecode: 0x560a2790ee68&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>plot</span></code></pre></div>
<pre><code>## function (x, y, ...) 
## UseMethod(&quot;plot&quot;)
## &lt;bytecode: 0x560a256a30b0&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>summary</span></code></pre></div>
<pre><code>## function (object, ...) 
## UseMethod(&quot;summary&quot;)
## &lt;bytecode: 0x560a2a9420c8&gt;
## &lt;environment: namespace:base&gt;</code></pre></li>
<li><p>The key of a generic is its goals. Methods should generally align with the goals of the generic so that R users don’t get unexpected results. E.g. when you type <code>plot()</code> you shouldn’t output a mean (even though S3 makes this valid behavior).</p></li>
<li><p>How <code>UseMethod()</code> works: If an object has a class vector of <code>c("cl1", "cl2")</code> then <code>UseMethod()</code> will first search for a method for <code>cl1</code>, if it does not exist it will use the method for <code>cl2</code>, and if that does not exist it will use the default method (there is usually one).</p></li>
<li><p>E.g. all tibbles have class</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>mt_tb <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(mtcars)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mt_tb)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre></li>
<li><p>So any generic called with a tibble will first search for a <code>tbl_df</code> method, then a <code>tbl</code> method, then a <code>data.frame</code> method, then a default method (which would be for a list if applicable since tibbles are built on lists).</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">print</span>(mt_tb))</span></code></pre></div>
<pre><code>##    print.tbl_df
## =&gt; print.tbl
##  * print.data.frame
##  * print.default</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">str</span>(mt_tb))</span></code></pre></div>
<pre><code>## =&gt; str.tbl_df
##    str.tbl
##  * str.data.frame
##  * str.default</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">summary</span>(mt_tb))</span></code></pre></div>
<pre><code>##    summary.tbl_df
##    summary.tbl
## =&gt; summary.data.frame
##  * summary.default</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">mean</span>(mt_tb))</span></code></pre></div>
<pre><code>##    mean.tbl_df
##    mean.tbl
##    mean.data.frame
## =&gt; mean.default</code></pre></li>
<li><p>The “default” class is not a real class, but is there so that there is always a fall back.</p></li>
</ul>
</div>
<div id="methods" class="section level1">
<h1>Methods</h1>
<ul>
<li><p>To create a method</p>
<ol style="list-style-type: decimal">
<li>Create a function definition for <code>generic.method()</code>.</li>
<li>Make sure you use the same arguments as the generic.</li>
</ol></li>
<li><p>E.g., let’s create plot and print methods for our <code>factor2</code> class.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>print.factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">attr</span>(x, <span class="st">&quot;levels&quot;</span>)[x])</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(x))</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>plot.factor2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">y =</span> <span class="cn">NULL</span>) {</span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  tabx <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="fu">attr</span>(x, <span class="st">&quot;levels&quot;</span>)[x])</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">barplot</span>(<span class="fu">table</span>(<span class="fu">attr</span>(x, <span class="st">&quot;levels&quot;</span>)[x]))</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(x))</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>Now, we get better printing for <code>factor2</code>’s</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor2</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;B&quot;</code></pre></li>
<li><p>If you don’t know, whenever you just run something and have it print to the console, that is R implicitely running <code>print()</code>. So this looks better too:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;B&quot;</code></pre></li>
<li><p>We can verify that method dispatch is working appropriately</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(<span class="fu">print</span>(x))</span></code></pre></div>
<pre><code>## =&gt; print.factor2
##  * print.default</code></pre></li>
<li><p>Plotting looks better too</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x)</span></code></pre></div>
<p><img src="05_s3_files/figure-html/unnamed-chunk-43-1.png" width="384" style="display: block; margin: auto;" /></p></li>
<li><p>You should only build methods for classes you own, or generics you own. It is considered bad manners to define a method for a class you do not own unless you own the generics.</p></li>
<li><p>E.g. if you define a new print method for <code>tbl_df</code>, then include that in your package, that would be impolite to the tiderverse folks.</p></li>
<li><p>A method should have the same arguments as the generic. You can have more arguments if the generic has <code>...</code> in it. E.g. if you create <code>plot()</code>, then you must include <code>x</code> and <code>y</code>, but may include anything else.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">formals</span>(plot)</span></code></pre></div>
<pre><code>## $x
## 
## 
## $y
## 
## 
## $...</code></pre></li>
<li><p><strong>Exercise</strong> (Advanced R): What generics does the <code>table</code> class have methods for?</p></li>
<li><p><strong>Exercise</strong>: Create a new generic called <code>pop</code> that will remove the last element and return the shorted object. Make a default method for any vector. Then make methods for the <code>matrix</code> class that will remove the last column or row, depending on the user choice of an argument called <code>by</code>.</p></li>
</ul>
</div>
<div id="the-design-of-an-s3-object" class="section level1">
<h1>The Design of an S3 Object</h1>
<ul>
<li><p>There are three most common structures for an S3 object.</p></li>
<li><p>In decreasing order of most common usage by you:</p></li>
</ul>
<ol style="list-style-type: decimal">
<li><p>A list-like object, where the list represents one thing (e.g. model output, funciton, dataset, etc…).</p>
<ul>
<li>For example, the output of <code>lm()</code> is a list like object that represents one model fit.</li>
</ul>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>lmout <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars)</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(lmout)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(lmout)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<ul>
<li>I use this format all of the time for the outputs of my model fits.</li>
</ul></li>
<li><p>A vector with new functionality. E.g. <code>factor</code>s and <code>Date</code>s. You combine, print, mathematically operate with these vectors in different ways.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">otype</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;S3&quot;</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre></li>
<li><p>Lists of equal length length vectors. E.g. <code>data.frame</code>s and <code>POSIXlt</code> objects.</p>
<ul>
<li><code>POSIXlt</code> objects are lists of years, days, minutes, seconds, etc… with the <code>i</code>th element of each vector contributing to indicating the same moment in time.</li>
</ul>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.POSIXlt</span>(<span class="fu">ISOdatetime</span>(<span class="dv">2020</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;2020-01-01 00:00:01 EST&quot; &quot;2020-01-01 00:00:02 EST&quot;
## [3] &quot;2020-01-01 00:00:03 EST&quot;</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<ul>
<li><code>data.frame</code> objects are lists of vectors where each vector is a variable and the <code>i</code>th element of each vector represents the same observational unit.</li>
</ul>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">typeof</span>(mtcars)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre></li>
</ol>
</div>
<div id="inheritance" class="section level1">
<h1>Inheritance</h1>
<ul>
<li><p><strong>Inheritance</strong> is shared behavior. You can make your new class inherit from another class so that if you did not create a method, then it will fall back on the parent method.</p></li>
<li><p>We call the child class the <strong>subclass</strong> and the parent class the <strong>superclass</strong>.</p></li>
<li><p>E.g. the <code>tbl_df</code> (sub)class inherits from the <code>data.frame</code> (super)class.</p></li>
<li><p>You can simply create a subclass by including a vector of in the <code>class</code> attribute.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>mt_tb <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(mtcars)</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mt_tb)</span></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre></li>
<li><p>You should make sure your subclass is of the same base type as the superclass you are inheriting from. E.g. make sure anything you build off of data.frames also has a list base type.</p></li>
<li><p>You should make sure that you have at least all of the same attributes as the superclass you are inheriting from. E.g. <code>data.frame</code>s can have <code>names</code> and <code>row.names</code>, and so any subclass should also have those attributes.</p></li>
</ul>
<div id="next-method" class="section level2">
<h2>Next Method</h2>
<ul>
<li><p><code>NextMethod()</code> allows you define methods for your class that use the functionality of classes that you inherit from.</p></li>
<li><p>E.g. recall that most attributes are lost with <code>[</code>.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">factor2</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 1</code></pre></li>
<li><p>This is because R is using the integer version for <code>[</code> and so we lose the class.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(x[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>##    [.factor2
##    [.default
## =&gt; [ (internal)</code></pre></li>
<li><p>We cannot use <code>[</code> inside a definition for a method because we haven’t defined it yet.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="do">## won&#39;t work</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[.factor2</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, i) {</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x[i]) <span class="co"># but we haven&#39;t defined `[` yet</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span>] <span class="do">## infinite recursion</span></span></code></pre></div></li>
<li><p>You can define your method to use the next method by <code>NextMethod()</code>. <code>NextMethod()</code> will take the arguments inside your function defintion and run them through the next method in the inheritance list. So it returns an unclassed object, that you can then pass to your constructor function.</p></li>
<li><p>Make sure you also include the attributes in your constructor.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[.factor2</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, i) {</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_factor2</span>(<span class="fu">NextMethod</span>(), <span class="at">levels =</span> <span class="fu">attr</span>(x, <span class="st">&quot;levels&quot;</span>))</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>sloop<span class="sc">::</span><span class="fu">s3_dispatch</span>(x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span></code></pre></div>
<pre><code>## =&gt; [.factor2
##    [.default
## -&gt; [ (internal)</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot;</code></pre></li>
<li><p>If we did not pass <code>NextMethod()</code> to our constructor, it would just run the integer subsetting:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">[.factor2</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="cf">function</span>(x, i) {</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">NextMethod</span>()</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 1 1 2</code></pre></li>
</ul>
</div>
</div>
<div id="example-simulation" class="section level1">
<h1>Example: Simulation</h1>
<ul>
<li><p>Let’s work again on an a simulation function for linear regression. We started this in the <a href="./03_testing.html">Assertions and Unit Tests</a> lecture.</p></li>
<li><p>The basic function we had was as follows:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>simreg <span class="ot">&lt;-</span> <span class="cf">function</span>(x, beta0, beta1, sigma) {</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  eps <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> beta0 <span class="sc">+</span> beta1 <span class="sc">*</span> x <span class="sc">+</span> eps</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></li>
<li><p>Let’s have a constructor that can build a useful class. We will inherit from the <code>data.frame</code> class.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>new_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dat =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">double</span>(),</span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">double</span>()),</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">beta0 =</span> <span class="fu">double</span>(),</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">beta1 =</span> <span class="fu">double</span>(),</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">sigma =</span> <span class="fu">double</span>(),</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">row.names =</span> <span class="cn">NULL</span>) {</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">is.list</span>(dat),</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.double</span>(beta0),</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.double</span>(beta1),</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">is.double</span>(sigma),</span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>            sigma <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">structure</span>(<span class="fu">as.data.frame</span>(dat, <span class="at">row.names =</span> row.names),</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">beta0 =</span> beta0,</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">beta1 =</span> beta1,</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">sigma =</span> sigma,</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">class =</span> <span class="st">&quot;sim&quot;</span>)</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a><span class="fu">new_sim</span>(<span class="at">dat =</span> <span class="fu">list</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)))</span></code></pre></div>
<pre><code>## $x
## [1] 1 2 3
## 
## $y
## [1] 4 5 6
## 
## attr(,&quot;class&quot;)
## [1] &quot;sim&quot;
## attr(,&quot;row.names&quot;)
## [1] 1 2 3
## attr(,&quot;beta0&quot;)
## numeric(0)
## attr(,&quot;beta1&quot;)
## numeric(0)
## attr(,&quot;sigma&quot;)
## numeric(0)</code></pre></li>
</ul>
</div>
<div id="new-functions" class="section level1">
<h1>New functions</h1>
<ul>
<li><code>class()</code>: Assign or get the class attribute.</li>
<li><code>unclass()</code>: Remove class attribute and obtain underlying base type.</li>
<li><code>inherits()</code>: Test if an object is an instance of a given class.</li>
<li><code>sloop::ftype()</code>: See if a function is a “regular/primitive/internal function, a internal/S3/S4 generic, or a S3/S4/RC method”.</li>
<li><code>sloop::s3_dispatch()</code>: View method dispatch.</li>
<li><code>sloop::s3_methods_generic()</code>: View all methods of a generic function.</li>
<li><code>sloop::s3_methods_class()</code>: View all methods implemented for a specific class.</li>
</ul>
</div>

<!DOCTYPE html>
<hr>
<a href="https://nsf.gov/awardsearch/showAward?AWD_ID=2132247"><img src="https://dcgerard.github.io/advancedr/nsf_logo.png" alt="National Science Foundation Logo" height="48px"/></a>
<a href="https://www.american.edu/cas/mathstat/"><img src="https://dcgerard.github.io/advancedr/au_logo.png" alt="American University Logo" height="48px"/></a>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
